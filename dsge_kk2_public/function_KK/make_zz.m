function [ZZ1, ZZ_leverage1 ] = make_zz()

para_names = {'sig','theta','kai','inv_zeta',...
     'muu','phi_o_y','gamma_w','ksi_w', ...
     'gamma_p','ksi_p','phi_r','phi_pi','phi_y','z_star_bar','pssi_bar', ...
     'eta','n_k','muu_E','r_E_bar', ...
     'rho_b','rho_g','rho_w','rho_p','rho_r','rho_nu','rho_z','rho_pssi', ...
     'rho_efp','rho_nw', ...
     'sig_b','sig_g','sig_w','sig_p','sig_r', ...
     'sig_nu','sig_z','sig_pssi','sig_efp','sig_nw'};

syms sig theta kai inv_zeta muu phi_o_y gamma_w ksi_w ...
     gamma_p ksi_p phi_r phi_pi phi_y z_star_bar pssi_bar ...
     eta n_k muu_E r_E_bar ...
     rho_b rho_g rho_w rho_p rho_r rho_nu rho_z rho_pssi ...
     rho_efp rho_nw ...
     sig_b sig_g sig_w sig_p sig_r ...
     sig_nu sig_z sig_pssi sig_efp sig_nw
     
syms z_star pssi l l_bar pii pi_bar r_n r_n_bar r_E c_y i_y ...
     delta alph lambda_w lambda_i

syms c_t lambda_t w_t b_t Et_r_E_t1 q_t n_t r_k_t u_t ...
     mc_t pi_t pi_t_lg1 pi_t_lg2 ...
     y_t i_t k_t r_n_t y_star_t ...
     z_b_t z_g_t z_w_t z_p_t z_nu_t z_r_t z_z_t z_pssi_t ...
     z_efp_t z_nw_t z_star_t l_t ...
     Et_c_t1 Et_lambda_t1 Et_w_t1 Et_q_t1 Et_r_k_t1 Et_pi_t1 Et_i_t1 ...
     Et_z_b_t1 Et_z_pssi_t1 Et_z_star_t1
     
syms c_ta lambda_ta w_ta b_ta Et_r_E_t1a q_ta n_ta r_k_ta u_ta ...
     mc_ta pi_ta pi_t_lg1a pi_t_lg2a ...
     y_ta i_ta k_ta r_n_ta y_star_ta ...
     z_b_ta z_g_ta z_w_ta z_p_ta z_nu_ta z_r_ta z_z_ta z_pssi_ta ...
     z_efp_ta z_nw_ta z_star_ta l_ta ...
     Et_c_t1a Et_lambda_t1a Et_w_t1a Et_q_t1a Et_r_k_t1a Et_pi_t1a ...
     Et_i_t1a Et_z_b_t1a Et_z_pssi_t1a Et_z_star_t1a

syms eta_c eta_lambda eta_w eta_q eta_r_k eta_pi eta_i ...
     eta_z_b eta_z_pssi eta_z_star

syms epssilon_b epssilon_g epssilon_w epssilon_p epssilon_nu epssilon_r ...
     epssilon_z epssilon_pssi epssilon_efp epssilon_nw
 
 syms Et_chi_t1 chi_t eta_chi Et_chi_t1a chi_ta r_E_t r_E_ta ...
      z_i_t z_i_ta eta_chi epssilon_i rho_i sig_i

parameters = [sig; theta; kai; inv_zeta; muu; phi_y; gamma_w; ksi_w; ...
     gamma_p; ksi_p; phi_r; phi_pi; phi_y; z_star_bar; pssi_bar; ...
     eta; n_k; muu_E; r_E_bar; ...
     rho_b; rho_g; rho_w; rho_p; rho_r; rho_nu; rho_z; rho_pssi; ...
     rho_efp; rho_nw; ...
     sig_b; sig_g; sig_w; sig_p; sig_r; ...
     sig_nu; sig_z; sig_pssi; sig_efp; sig_nw];

%% Endogenous Variables (40)
Y_t = [c_t; lambda_t; w_t; b_t; r_E_t; q_t; n_t; r_k_t; u_t; ...
     mc_t; pi_t; pi_t_lg1; pi_t_lg2; ...
     y_t; i_t; k_t; r_n_t; ...
     z_b_t; z_g_t; z_w_t; z_p_t; z_nu_t; z_r_t; z_z_t; z_pssi_t; ...
     z_efp_t; z_nw_t; z_star_t; l_t; ...
     Et_chi_t1; chi_t; z_i_t; ...
     Et_c_t1; Et_lambda_t1; Et_w_t1; Et_r_k_t1; Et_pi_t1; Et_i_t1; ...
     Et_z_b_t1;  Et_z_star_t1];

%% Endogenous Variables(lagged) (40)
Y_ta = [c_ta; lambda_ta; w_ta; b_ta; r_E_ta; q_ta; n_ta; r_k_ta; u_ta; ...
     mc_ta; pi_ta; pi_t_lg1a; pi_t_lg2a; ...
     y_ta; i_ta; k_ta; r_n_ta; ...
     z_b_ta; z_g_ta; z_w_ta; z_p_ta; z_nu_ta; z_r_ta; z_z_ta; z_pssi_ta; ...
     z_efp_ta; z_nw_ta; z_star_ta; l_ta; ...
     Et_chi_t1a; chi_ta; z_i_ta; ...
     Et_c_t1a; Et_lambda_t1a; Et_w_t1a; Et_r_k_t1a; Et_pi_t1a; Et_i_t1a; ...
     Et_z_b_t1a;  Et_z_star_t1a];

%% Forecast Errors (9)
Eta_t = [eta_c; eta_lambda; eta_w; eta_chi; eta_r_k; eta_pi; eta_i; ...
         eta_z_b; eta_z_star];

%% Exogenous Shock Variables (11)
Epssilon_t = [epssilon_b; epssilon_g; epssilon_w; epssilon_p; epssilon_nu; ...
             epssilon_r; epssilon_z; epssilon_pssi; epssilon_i; epssilon_efp; epssilon_nw];

%% Structual Equations(17)
Eq_S1 = -lambda_t - 1/(1-theta*pii/r_n)*(sig/(1-theta/z_star)* ...
        (c_t-theta/z_star*(c_ta-z_star_t))-z_b_t) + ...
        theta*pii/r_n/(1-theta*pii/r_n)*(sig/(1-theta/z_star)* ...
        (Et_c_t1+Et_z_star_t1-theta/z_star*c_t) - Et_z_b_t1);

Eq_S2 = -lambda_t+Et_lambda_t1-sig*Et_z_star_t1+r_n_t-Et_pi_t1;

Eq_S3 = -w_t+w_ta-pi_t+gamma_w*pi_ta-z_star_t+z_star*pii/r_n* ...
      (Et_w_t1-w_t+Et_pi_t1-gamma_w*pi_t+Et_z_star_t1) +...
      (1-ksi_w)*(1-ksi_w*z_star*pii/r_n)/ksi_w/(1+kai*(1+lambda_w)/lambda_w)*...
      (kai*l_t-lambda_t-w_t+z_b_t) + z_w_t;

Eq_S4 = -b_t + (1+lambda_i)/(1+lambda_i-n_k)*(q_t+k_t)+...
        (1-(1+lambda_i)/(1+lambda_i-n_k))*n_t;

 Eq_S5 = -chi_t + (1-(1-delta)/r_n/pssi)*r_k_t+...   
        ((1-delta)/r_n/pssi)*q_t - q_ta - z_pssi_t;  

Eq_S6 = -r_E_t + r_n_t - muu_E*(n_t-q_t-k_t) + z_efp_t;

Eq_S7 = -z_star/eta/r_E*n_t + (1+lambda_i)/n_k*...
        ((1-(1-delta)/r_E/pssi)*r_k_t+(1-delta)/r_E/pssi*q_t-q_ta-z_pssi_t)-...
        ((1+lambda_i)/n_k-1)*Et_r_E_t1a+ ...
        n_ta - z_star_t + z_nw_t;

Eq_S8 = w_t + l_t - (r_k_t+u_t+k_ta-z_star_t-z_pssi_t);
Eq_S9 = -u_t + muu*(r_k_t-q_t);
Eq_S10 = -mc_t + (1-alph)*w_t + alph*r_k_t;

Eq_S11 = -pi_t + gamma_p*pi_ta+z_star*pii/r_n*(Et_pi_t1-gamma_p*pi_t)+...
         (1-ksi_p)*(1-ksi_p*z_star*pii/r_n)/ksi_p*mc_t+z_p_t;

Eq_S12 = -y_t + (1+phi_o_y)*((1-alph)*l_t+alph*(u_t+k_ta-z_star_t-z_pssi_t));
Eq_S13 = -y_t + c_y*c_t + i_y*i_t + z_g_t;

Eq_S14 = -k_t + (1-delta-r_n*pssi/pii)/z_star/pssi*u_t+ ...
         (1-delta)/z_star/pssi*(k_ta-z_star_t-z_pssi_t)+ ...
         (1-(1-delta)/z_star/pssi)*(i_t+z_nu_t);

Eq_S15 = -q_t + inv_zeta*(i_t-i_ta+z_star_t+z_pssi_t)-...
         inv_zeta*z_star*pii/r_n*(Et_i_t1-i_t+Et_z_star_t1+...
         Et_z_pssi_t1)-z_nu_t+z_i_t;

Eq_S16 = -r_n_t + phi_r*r_n_ta+(1-phi_r)*...
        (0.25*phi_pi*(pi_t+pi_t_lg1+pi_t_lg2+pi_t_lg2a)+...
        phi_y*(y_t-y_ta))+z_r_t;

Eq_S17 = -Et_chi_t1 + r_E_t - Et_pi_t1;

%% Forecast Errors(9)
Eq_F1 = -c_t + Et_c_t1a + eta_c;
Eq_F2 = -lambda_t + Et_lambda_t1a + eta_lambda;
Eq_F3 = -w_t + Et_w_t1a + eta_w;
Eq_F4 = -chi_t + Et_chi_t1a + eta_chi;
Eq_F5 = -r_k_t + Et_r_k_t1a + eta_r_k;
Eq_F6 = -pi_t + Et_pi_t1a + eta_pi;
Eq_F7 = -i_t + Et_i_t1a + eta_i;
Eq_F8 = -z_b_t + Et_z_b_t1a + eta_z_b;
Eq_F9 = -z_star_t + Et_z_star_t1a + eta_z_star;

%% Persistent Shocks(11)
Eq_P1 = -z_b_t + rho_b*z_b_ta + epssilon_b;
Eq_P2 = -z_g_t + rho_g*z_g_ta + epssilon_g;
Eq_P3 = -z_w_t + rho_w*z_w_ta + epssilon_w;
Eq_P4 = -z_p_t + rho_p*z_p_ta + epssilon_p;
Eq_P5 = -z_nu_t + rho_nu*z_nu_ta + epssilon_nu;
Eq_P6 = -z_r_t + rho_r*z_r_ta + epssilon_r;
Eq_P7 = -z_z_t + rho_z*z_z_ta + epssilon_z;
Eq_P8 = -z_pssi_t + rho_pssi*z_pssi_ta + epssilon_pssi;
Eq_P9 = -z_i_t + rho_i*z_i_ta + epssilon_i;
Eq_P10 = -z_efp_t + rho_efp*z_efp_ta + epssilon_efp;
Eq_P11 = -z_nw_t + rho_nw*z_nw_ta + epssilon_nw;

%% Identities(3)
Eq_I1 = -z_star_t + z_z_t + alph/(1-alph)*z_pssi_t;
Eq_I2 = -pi_t_lg1 + pi_ta;
Eq_I3 = -pi_t_lg2 + pi_t_lg1a;

%% n.eq = 40
System_of_Eq = [Eq_S1; Eq_S2; Eq_S3; Eq_S4; Eq_S5; ...
                Eq_S6; Eq_S7; Eq_S8; Eq_S9; Eq_S10; ...
                Eq_S11; Eq_S12; Eq_S13; Eq_S14; Eq_S15; ...
                Eq_S16; Eq_S17; ...
                Eq_F1; Eq_F2; Eq_F3; Eq_F4; Eq_F5; ...
                Eq_F6; Eq_F7; Eq_F8; Eq_F9;  ...
                Eq_P1; Eq_P2; Eq_P3; Eq_P4; Eq_P5; ...
                Eq_P6; Eq_P7; Eq_P8; Eq_P9; Eq_P10;  Eq_P11; ...
                Eq_I1; Eq_I2; Eq_I3];


Z0 = [z_star_t + y_t - y_ta; ...
      z_star_t + c_t - c_ta; ...
      z_star_t + z_pssi_t + i_t - i_ta; ...
      z_star_t + w_t - w_ta; ...
      l_t; ...
      pi_t; ...
      -z_pssi_t + z_nu_t - z_nu_ta; ...
      r_n_t; ...     
      z_star_t + b_t - b_ta;
      r_E_t    ];

nvar = size(Z0, 1);
%nirf = 20; 
Z = jacobian(Z0, Y_t); 
Zlg = jacobian(Z0, Y_ta); 
ZZ = [Z,Zlg];

ZZ1 = eval(ZZ);

Z0_leverage = [  z_efp_t ];
% Z0_leverage = [ qt + kt - n_t ];
Z_leverage = jacobian(Z0_leverage, Y_t);
Zlg_leverage = jacobian(Z0_leverage, Y_ta);
ZZ_leverage = [Z_leverage, Zlg_leverage];
ZZ_leverage1 = eval(ZZ_leverage);




